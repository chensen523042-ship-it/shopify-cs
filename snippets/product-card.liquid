{% comment %}
  Renders a product card within a product list. Usually within a collection template or the Product list section

  Accepts:
  - product: {object} The product object - https://shopify.dev/docs/api/liquid/objects/product

  Usage:
  {% render 'product-card' product: product  %}
{% endcomment %}

<div class="product-card {{ settings.product_card_text_align }}">
  <a 
    href="{{ product.url | within: collection }}" 
    class="product-card-link">
    <div class="product-card-img-wrapper mb-4">      
      {% if product.available == false %}
        <span class="product-sold-out-badge badge"
          {% if current_variant.available %}hidden{% endif %}>
          {{ 'product.sold_out' | t }}
        </span>  
      {% elsif product.compare_at_price > product.price %}
        <span 
          class="product-sale-badge badge"
          data-discount-type="{{ settings.product_card_badge_discount_type }}"> 
          {% if product.compare_at_price > 0 %}
            {% if settings.product_card_badge_discount_type == 'percentage' %} 
              <span class="visually-hidden">
                {{ 'product.save' | t }} 
              </span>
              {{ product.compare_at_price | minus: product.price | times: 100 | divided_by: product.compare_at_price | round | prepend: '-' | append: '%' }}
            {% else %}
              {{ 'product.save' | t }} 
              {{ product.compare_at_price | minus: product.price | money_without_trailing_zeros }}
            {% endif %}
          {% endif %}
        </span>
      {% endif %}
      {% render 'image-url', img: product.featured_image, orientation: settings.product_card_img_orientation, class: settings.product_card_img_border %}
    </div>
    <h3 class="product-card-title product-title {{ settings.product_card_title_font_size }}">
      {{ product.title }}
    </h3>
    {% render 'product-rating-badge', product: product %}
    {% render 'product-card-price', product: product %}
  </a>
  {% if settings.product_card_show_atc_form %}
    {% render 'product-card-form', product: product %}
  {% endif %}
</div>

{%- assign hover_video = product.media | where: 'media_type', 'video' | first -%}
{%- comment -%}
如果你是用外链视频（YouTube/Vimeo），media_type 是 external_video。
不过要实现“悬浮即播”更推荐上传 MP4 到产品媒体，这样是 <video> 标签，最稳定。
{%- endcomment -%}

<div class="product-card__media-wrapper {% if hover_video %}has-hover-video{% endif %}">
  <a href="{{ product.url }}" class="product-card__link">
    {%- comment -%} 封面图 {%- endcomment -%}
    {{ product.featured_media
      | image_url: width: 800
      | image_tag:
        loading: 'lazy',
        class: 'product-card__img'
    }}

    {%- if hover_video -%}
      <div class="product-card__video-wrap" hidden>
        {{ hover_video | video_tag:
            autoplay: false,
            loop: true,
            muted: true,
            controls: false,
            playsinline: true,
            preload: 'none',
            class: 'product-card__video',
            id: 'vid-' | append: product.id
        }}
      </div>
    {%- endif -%}
  </a>
</div>
