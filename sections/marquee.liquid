{% comment %}
  Infinite Marquee Section (seamless, no gaps or jumps)
  File: sections/marquee.liquid
  This version creates true infinite scroll by:
  - Using ONE flex track that contains SIX copies of the items in a single list.
  - Animating the whole track from 0 to -16.666% so the next copy lines up perfectly.
  - Creating enough copies to ensure seamless infinite scrolling on any screen size.
{% endcomment %}

<section
  id="marquee-{{ section.id }}"
  class="marquee-section"
  style="
    --mq-bg: {{ section.settings.background_color | default: 'transparent' }};
    --mq-color: {{ section.settings.text_color | default: '#111111' }};
    --mq-gap: {{ section.settings.gap | default: 32 }}px;
    --mq-speed: {{ section.settings.speed | default: 24 }}s;
    --mq-size-desktop: {{ section.settings.font_size_desktop | default: 18 }}px;
    --mq-size-mobile: {{ section.settings.font_size_mobile | default: 16 }}px;
    --mq-letter: {{ section.settings.letter_spacing | default: 0 }}px;
    --mq-pad-top: {{ section.settings.padding_top }}px;
    --mq-pad-bottom: {{ section.settings.padding_bottom }}px;
  "
  data-direction="{{ section.settings.direction }}"
  data-pause="{{ section.settings.pause_on_hover }}"
  data-reduced-motion="{{ section.settings.enable_reduced_motion }}"
>
  <div class="marquee__mask {{ section.settings.container_width }}">
    <ul class="marquee__content" role="list" aria-label="Scrolling announcements">
      {%- comment -%} Create multiple copies for true infinite scroll {%- endcomment -%}
      {%- for i in (1..6) -%}
        {%- for block in section.blocks -%}
          <li class="marquee__item marquee__item--{{ block.type }}" {% if i == 1 %}{{ block.shopify_attributes }}{% else %}aria-hidden="true"{% endif %}>
            {%- case block.type -%}
              {%- when 'text' -%}
                {%- assign txt = block.settings.text | strip -%}
                {%- if txt != '' -%}
                  {%- if block.settings.link != blank -%}
                    <a class="marquee__link" href="{{ block.settings.link }}" {% if i == 1 %}aria-label="{{ txt | escape }}"{% endif %}>
                      <span class="marquee__text {{ section.settings.text_style }}{% if section.settings.uppercase %} is-upper{% endif %}">
                        {{- txt -}}
                      </span>
                    </a>
                  {%- else -%}
                    <span class="marquee__text {{ section.settings.text_style }}{% if section.settings.uppercase %} is-upper{% endif %}">
                      {{- txt -}}
                    </span>
                  {%- endif -%}
                {%- endif -%}
              
              {%- when 'image' -%}
                {%- if block.settings.image != blank -%}
                  {%- if block.settings.link != blank -%}
                    <a class="marquee__link marquee__image-link" href="{{ block.settings.link }}" {% if i == 1 %}aria-label="{{ block.settings.alt_text | default: 'Image' | escape }}"{% endif %}>
                      <img 
                        class="marquee__image" 
                        src="{{ block.settings.image | image_url: width: block.settings.image_width | default: 40 }}" 
                        alt="{{ block.settings.alt_text | default: '' }}"
                        width="{{ block.settings.image_width | default: 40 }}"
                        height="{{ block.settings.image_height | default: 40 }}"
                        loading="lazy"
                      >
                    </a>
                  {%- else -%}
                    <img 
                      class="marquee__image" 
                      src="{{ block.settings.image | image_url: width: block.settings.image_width | default: 40 }}" 
                      alt="{{ block.settings.alt_text | default: '' }}"
                      width="{{ block.settings.image_width | default: 40 }}"
                      height="{{ block.settings.image_height | default: 40 }}"
                      loading="lazy"
                    >
                  {%- endif -%}
                {%- endif -%}
              
              {%- when 'icon' -%}
                {%- if block.settings.icon_type == 'svg' and block.settings.svg_icon != blank -%}
                  {%- if block.settings.link != blank -%}
                    <a class="marquee__link marquee__icon-link" href="{{ block.settings.link }}" {% if i == 1 %}aria-label="{{ block.settings.icon_alt | default: 'Icon' | escape }}"{% endif %}>
                      <span class="marquee__icon marquee__icon--svg" style="color: {{ block.settings.icon_color | default: 'inherit' }};">
                        {% render 'svg-icons', icon: block.settings.svg_icon, size: block.settings.icon_size | default: 24, stroke_width: block.settings.stroke_width | default: 2 %}
                      </span>
                    </a>
                  {%- else -%}
                    <span class="marquee__icon marquee__icon--svg" style="color: {{ block.settings.icon_color | default: 'inherit' }};">
                      {% render 'svg-icons', icon: block.settings.svg_icon, size: block.settings.icon_size | default: 24, stroke_width: block.settings.stroke_width | default: 2 %}
                    </span>
                  {%- endif -%}
                {%- elsif block.settings.icon_type == 'text' and block.settings.text_icon != blank -%}
                  {%- if block.settings.link != blank -%}
                    <a class="marquee__link marquee__icon-link" href="{{ block.settings.link }}" {% if i == 1 %}aria-label="{{ block.settings.icon_alt | default: 'Icon' | escape }}"{% endif %}>
                      <span class="marquee__icon marquee__icon--text" style="font-size: {{ block.settings.icon_size | default: 24 }}px; color: {{ block.settings.icon_color | default: 'inherit' }};">
                        {{ block.settings.text_icon }}
                      </span>
                    </a>
                  {%- else -%}
                    <span class="marquee__icon marquee__icon--text" style="font-size: {{ block.settings.icon_size | default: 24 }}px; color: {{ block.settings.icon_color | default: 'inherit' }};">
                      {{ block.settings.text_icon }}
                    </span>
                  {%- endif -%}
                {%- endif -%}
            {%- endcase -%}
          </li>
        {%- endfor -%}
      {%- endfor -%}
    </ul>
  </div>

  <style>
    #marquee-{{ section.id }} { background: var(--mq-bg); color: var(--mq-color); padding-top: var(--mq-pad-top); padding-bottom: var(--mq-pad-bottom); }

    /* Containers */
    #marquee-{{ section.id }} .marquee__mask { overflow: hidden; }
    #marquee-{{ section.id }} .page-width { max-width: var(--page-width, 1200px); margin-inline: auto; padding-inline: 2rem; }
    #marquee-{{ section.id }} .full-width { width: 100%; }

    /* Track */
    #marquee-{{ section.id }} .marquee__content {
      display: inline-flex;
      gap: var(--mq-gap);
      align-items: center;
      padding: 0;
      margin: 0;
      list-style: none;
      white-space: nowrap;
      width: max-content; /* allow intrinsic width so 50% equals one full copy */
      will-change: transform;
      animation-name: marquee-scroll-{{ section.id }};
      animation-duration: var(--mq-speed);
      animation-timing-function: linear;
      animation-iteration-count: infinite;
    }
    /* Reverse direction */
    #marquee-{{ section.id }}[data-direction="right"] .marquee__content { animation-direction: reverse; }

    /* Pause on hover */
    #marquee-{{ section.id }}[data-pause="true"] .marquee__content:hover { animation-play-state: paused; }

    /* Items - 确保所有元素垂直居中对齐 */
    #marquee-{{ section.id }} .marquee__item { 
      flex: 0 0 auto; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      min-height: 1em; /* 确保有最小高度 */
    }
    #marquee-{{ section.id }} .marquee__link { 
      color: inherit; 
      text-decoration: none; 
      display: flex; 
      align-items: center; 
      justify-content: center;
      height: 100%;
    }
    
    /* Text styles - 确保文本垂直居中 */
    #marquee-{{ section.id }} .marquee__text { 
      font-size: var(--mq-size-desktop); 
      letter-spacing: var(--mq-letter); 
      line-height: 1; 
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
    }
    #marquee-{{ section.id }} .marquee__text.is-upper { text-transform: uppercase; }
    
    /* Image styles - 确保图片垂直居中 */
    #marquee-{{ section.id }} .marquee__image { 
      display: block; 
      max-width: 100%; 
      height: auto; 
      object-fit: contain;
      vertical-align: middle;
    }
    #marquee-{{ section.id }} .marquee__image-link { 
      display: flex; 
      align-items: center; 
      justify-content: center;
      height: 100%;
      transition: opacity 0.2s ease;
    }
    #marquee-{{ section.id }} .marquee__image-link:hover { opacity: 0.8; }
    
    /* Icon styles - 确保图标垂直居中 */
    #marquee-{{ section.id }} .marquee__icon { 
      display: flex; 
      align-items: center; 
      justify-content: center;
      line-height: 1;
      height: 100%;
      transition: transform 0.2s ease;
    }
    #marquee-{{ section.id }} .marquee__icon--svg { 
      display: flex; 
      align-items: center; 
      justify-content: center;
      height: 100%;
    }
    #marquee-{{ section.id }} .marquee__icon--svg svg { 
      display: block; 
      vertical-align: middle;
    }
    #marquee-{{ section.id }} .marquee__icon--text { 
      display: flex; 
      align-items: center; 
      justify-content: center;
      height: 100%;
    }
    #marquee-{{ section.id }} .marquee__icon-link { 
      display: flex; 
      align-items: center; 
      justify-content: center;
      height: 100%;
      transition: transform 0.2s ease;
    }
    #marquee-{{ section.id }} .marquee__icon-link:hover .marquee__icon { 
      transform: scale(1.1); 
    }

    /* Keyframes: move exactly one copy width (16.666% of the 6-copy list) */
    @keyframes marquee-scroll-{{ section.id }} {
      from { transform: translateX(0); }
      to   { transform: translateX(-16.666%); }
    }

    /* Reduced motion */
    {% if section.settings.enable_reduced_motion %}
    @media (prefers-reduced-motion: reduce) { #marquee-{{ section.id }} .marquee__content { animation: none; } }
    {% endif %}

    /* Mobile font */
    @media (max-width: 749px) { #marquee-{{ section.id }} .marquee__text { font-size: var(--mq-size-mobile); } }
  </style>

  {%- comment -%}
    No JS needed for the seamless infinite loop. The 6 copies + -16.666% translate ensures no whitespace or jump.
  {%- endcomment -%}
</section>

{% schema %}
{
  "name": "Marquee",
  "tag": "section",
  "class": "section-marquee",
  "settings": [
    {
      "type": "select",
      "id": "container_width",
      "label": "Width",
      "default": "full-width",
      "options": [
        { "value": "full-width", "label": "Full width" },
        { "value": "page-width", "label": "Page width" }
      ]
    },
    {
      "type": "select",
      "id": "text_style",
      "label": "Text style",
      "default": "body",
      "options": [
        { "value": "h1", "label": "Heading 1" },
        { "value": "h2", "label": "Heading 2" },
        { "value": "h3", "label": "Heading 3" },
        { "value": "h4", "label": "Heading 4" },
        { "value": "h5", "label": "Heading 5" },
        { "value": "h6", "label": "Heading 6" },
        { "value": "body", "label": "Body" }
      ]
    },
    {
      "type": "range",
      "id": "font_size_desktop",
      "label": "Font size (desktop)",
      "min": 12,
      "max": 72,
      "step": 1,
      "default": 24
    },
    {
      "type": "range",
      "id": "font_size_mobile",
      "label": "Font size (mobile)",
      "min": 12,
      "max": 48,
      "step": 1,
      "default": 18
    },
    {
      "type": "range",
      "id": "letter_spacing",
      "label": "Letter spacing (px)",
      "min": 0,
      "max": 10,
      "step": 0.5,
      "default": 0
    },
    { "type": "checkbox", "id": "uppercase", "label": "Uppercase text", "default": false },

    { "type": "range", "id": "gap", "label": "Gap between items (px)", "min": 0, "max": 120, "step": 2, "default": 32 },
    {
      "type": "select",
      "id": "direction",
      "label": "Scroll direction",
      "default": "left",
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ]
    },
    {
      "type": "range",
      "id": "speed",
      "label": "Animation duration (seconds)",
      "min": 6,
      "max": 120,
      "step": 2,
      "default": 24
    },
    { "type": "checkbox", "id": "pause_on_hover", "label": "Pause on hover", "default": true },
    { "type": "checkbox", "id": "enable_reduced_motion", "label": "Respect reduced motion", "default": true },

    { "type": "color", "id": "background_color", "label": "Background color", "default": "#FFFFFF" },
    { "type": "color", "id": "text_color", "label": "Text color", "default": "#111111" },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding top (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 28
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding bottom (px)",
      "min": 0,
      "max": 120,
      "step": 4,
      "default": 28
    }
  ],
  "blocks": [
    {
      "type": "text",
      "name": "Text",
      "limit": 50,
      "settings": [
        { "type": "text", "id": "text", "label": "Text", "default": "Free shipping on orders over $50" },
        { "type": "url", "id": "link", "label": "Optional link" }
      ]
    },
    {
      "type": "image",
      "name": "Image",
      "limit": 50,
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "alt_text", "label": "Alt text", "info": "Describe the image for accessibility" },
        { "type": "range", "id": "image_width", "label": "Image width (px)", "min": 20, "max": 200, "step": 5, "default": 40 },
        { "type": "range", "id": "image_height", "label": "Image height (px)", "min": 20, "max": 200, "step": 5, "default": 40 },
        { "type": "url", "id": "link", "label": "Optional link" }
      ]
    },
    {
      "type": "icon",
      "name": "Icon",
      "limit": 50,
      "settings": [
        {
          "type": "select",
          "id": "icon_type",
          "label": "Icon type",
          "default": "svg",
          "options": [
            { "value": "svg", "label": "SVG Icon" },
            { "value": "text", "label": "Text/Emoji" }
          ]
        },
        {
          "type": "select",
          "id": "svg_icon",
          "label": "SVG Icon",
          "default": "star",
          "options": [
            { "value": "cart", "label": "Cart" },
            { "value": "account", "label": "Account" },
            { "value": "search", "label": "Search" },
            { "value": "heart", "label": "Heart" },
            { "value": "star", "label": "Star" },
            { "value": "truck", "label": "Truck" },
            { "value": "gift", "label": "Gift" },
            { "value": "lock", "label": "Lock" },
            { "value": "mail", "label": "Mail" },
            { "value": "phone", "label": "Phone" },
            { "value": "time", "label": "Time" },
            { "value": "tag", "label": "Tag" },
            { "value": "play", "label": "Play" },
            { "value": "plus", "label": "Plus" },
            { "value": "minus", "label": "Minus" },
            { "value": "x", "label": "Close" },
            { "value": "menu", "label": "Menu" },
            { "value": "more", "label": "More" },
            { "value": "alert-circle", "label": "Alert" },
            { "value": "remove", "label": "Remove" },
            { "value": "edit", "label": "Edit" },
            { "value": "filter", "label": "Filter" },
            { "value": "maximize", "label": "Maximize" },
            { "value": "arrow-top", "label": "Arrow Up" },
            { "value": "arrow-bottom", "label": "Arrow Down" },
            { "value": "arrow-left", "label": "Arrow Left" },
            { "value": "arrow-right", "label": "Arrow Right" },
            { "value": "chevron-left", "label": "Chevron Left" },
            { "value": "chevron-right", "label": "Chevron Right" },
            { "value": "chevron-up", "label": "Chevron Up" },
            { "value": "chevron-down", "label": "Chevron Down" },
            { "value": "recently-viewed", "label": "Recently Viewed" }
          ]
        },
        { "type": "text", "id": "text_icon", "label": "Text/Emoji Icon", "info": "Enter an emoji or icon character (e.g., ⭐, 🚚, 💎)", "default": "⭐" },
        { "type": "text", "id": "icon_alt", "label": "Icon description", "info": "Describe the icon for accessibility" },
        { "type": "range", "id": "icon_size", "label": "Icon size (px)", "min": 12, "max": 48, "step": 2, "default": 24 },
        { "type": "range", "id": "stroke_width", "label": "SVG stroke width", "min": 1, "max": 4, "step": 0.5, "default": 2, "info": "Only applies to SVG icons" },
        { "type": "color", "id": "icon_color", "label": "Icon color", "default": "#111111" },
        { "type": "url", "id": "link", "label": "Optional link" }
      ]
    }
  ],
  "max_blocks": 50,
  "presets": [
    {
      "name": "Marquee",
      "category": "Text",
      "blocks": [
        { "type": "text", "settings": { "text": "New arrivals dropping weekly" } },
        { "type": "icon", "settings": { "icon_type": "svg", "svg_icon": "truck", "icon_alt": "Truck icon" } },
        { "type": "text", "settings": { "text": "Free shipping over $50" } },
        { "type": "icon", "settings": { "icon_type": "svg", "svg_icon": "star", "icon_alt": "Star icon" } },
        { "type": "text", "settings": { "text": "Join our newsletter for 10% off" } }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
  /* Optional: map heading utility classes to your theme scale */
  .section-marquee .h1 {
    font-size: clamp(2rem, 3vw, 3rem);
    font-weight: 700;
  }
  .section-marquee .h2 {
    font-size: clamp(1.75rem, 2.5vw, 2.5rem);
    font-weight: 700;
  }
  .section-marquee .h3 {
    font-size: clamp(1.5rem, 2vw, 2rem);
    font-weight: 700;
  }
  .section-marquee .h4 {
    font-size: 1.25rem;
    font-weight: 600;
  }
  .section-marquee .h5 {
    font-size: 1.125rem;
    font-weight: 600;
  }
  .section-marquee .h6 {
    font-size: 1rem;
    font-weight: 600;
  }
  .section-marquee .body {
    font-size: inherit;
  }
{% endstylesheet %}
