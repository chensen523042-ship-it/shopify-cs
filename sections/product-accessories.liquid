{% comment %}
  Section: Product Accessories (for your theme using 'product-card' snippet)
  Data source: product.metafields[namespace][key]  (List of product references)
  Default metafield: custom.accessories
{% endcomment %}

{% liquid
  assign ns = section.settings.metafield_namespace | default: 'custom'
  assign key = section.settings.metafield_key | default: 'accessories'
  assign accessories = product.metafields[ns][key].value
  assign heading = section.settings.heading | default: '配件'
  assign columns = section.settings.columns_desktop | default: 4
  assign color_scheme = section.settings.color_scheme | default: 'background-1'
%}

{% if accessories != blank %}
<section class="page-width section-{{ section.id }} color-{{ color_scheme }}">
  {% if heading != blank %}
    <div class="title-wrapper-with-link">
      <h2 class="title h2">{{ heading }}</h2>
      {% if section.settings.view_all_link != blank %}
        <a href="{{ section.settings.view_all_link }}" class="link underlined-link">
          {{ section.settings.view_all_text | default: '查看全部' }}
        </a>
      {% endif %}
    </div>
  {% endif %}

  <ul class="accessories-grid accessories-grid--{{ columns }}" role="list">
    {% for item in accessories %}
      <li class="grid__item accessories-grid__item">
        {%- render 'product-card', product: item -%}
      </li>
    {% endfor %}
  </ul>
</section>
{% elsif section.settings.show_when_empty %}
<section class="page-width section-{{ section.id }} color-{{ color_scheme }}">
  {% if heading != blank %}
    <div class="title-wrapper-with-link">
      <h2 class="title h2">{{ heading }}</h2>
    </div>
  {% endif %}
  <p class="color-foreground-subtle">
    {{ section.settings.empty_text | default: '暂未配置配件。请在产品的 Accessories 元字段里添加。' }}
  </p>
</section>
{% endif %}

<style>
  /* 简单自适应栅格，复用主题的 .grid__item */
  .section-{{ section.id }} .accessories-grid {
    display: grid;
    gap: 2rem;
    justify-items: center; /* 让网格项居中 */
    max-width: 800px; /* 限制最大宽度，让整体更居中 */
    margin: 0 auto; /* 整体居中 */
  }
  
  /* 标题居中且字体更小 */
  .section-{{ section.id }} .title-wrapper-with-link {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .section-{{ section.id }} .title {
    font-size: 1.5rem; /* 减小字体大小 */
    font-weight: 500;
    margin: 0;
  }
  
  .section-{{ section.id }} .accessories-grid--2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  
  .section-{{ section.id }} .accessories-grid--3 {
    grid-template-columns: repeat(3, minmax(0, 1fr));
  }
  
  .section-{{ section.id }} .accessories-grid--4 {
    grid-template-columns: repeat(4, minmax(0, 1fr));
  }
  
  .section-{{ section.id }} .accessories-grid--5 {
    grid-template-columns: repeat(5, minmax(0, 1fr));
  }
  
  /* 让配件卡片更小 */
  .section-{{ section.id }} .accessories-grid__item {
    max-width: 200px; /* 限制每个配件项的最大宽度 */
    width: 100%;
  }
  
  /* 让配件卡片内的图片更小 */
  .section-{{ section.id }} .accessories-grid__item .product-card__media {
    max-width: 150px; /* 限制图片最大宽度 */
    margin: 0 auto; /* 图片居中 */
  }
  
  .section-{{ section.id }} .accessories-grid__item .product-card__media img {
    max-width: 100%;
    height: auto;
  }
  
  @media (max-width: 989px) {
    .section-{{ section.id }} .accessories-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 1.25rem;
      max-width: 600px; /* 平板端调整最大宽度 */
    }
    
    .section-{{ section.id }} .accessories-grid__item {
      max-width: 180px; /* 平板端调整卡片宽度 */
    }
    
    .section-{{ section.id }} .accessories-grid__item .product-card__media {
      max-width: 130px; /* 平板端调整图片宽度 */
    }
    
    .section-{{ section.id }} .title {
      font-size: 1.25rem; /* 平板端字体更小 */
    }
  }
  
  @media (max-width: 599px) {
    .section-{{ section.id }} .accessories-grid {
      grid-template-columns: 1fr;
      gap: 1rem;
      max-width: 300px; /* 手机端调整最大宽度 */
    }
    
    .section-{{ section.id }} .accessories-grid__item {
      max-width: 250px; /* 手机端调整卡片宽度 */
    }
    
    .section-{{ section.id }} .accessories-grid__item .product-card__media {
      max-width: 180px; /* 手机端调整图片宽度 */
    }
    
    .section-{{ section.id }} .title {
      font-size: 1.125rem; /* 手机端字体更小 */
    }
  }
</style>

{% schema %}
{
  "name": "Product Accessories",
  "tag": "section",
  "class": "section",
  "enabled_on": { "templates": ["product"] },
  "settings": [
    { "type": "text", "id": "heading", "label": "标题", "default": "配件" },
    { "type": "text", "id": "metafield_namespace", "label": "Metafield namespace", "default": "custom" },
    { "type": "text", "id": "metafield_key", "label": "Metafield key", "default": "accessories" },
    { "type": "range", "id": "columns_desktop", "label": "桌面端每行列数", "min": 2, "max": 5, "step": 1, "default": 4 },
    { "type": "checkbox", "id": "show_when_empty", "label": "没有配件时仍显示模块", "default": false },
    { "type": "text", "id": "empty_text", "label": "空数据提示", "default": "暂未配置配件。请在产品的 Accessories 元字段里添加。" },
    { "type": "url", "id": "view_all_link", "label": "“查看全部”链接（可选）" },
    { "type": "text", "id": "view_all_text", "label": "“查看全部”文案（可选）", "default": "查看全部" },
    {
      "type": "select",
      "id": "color_scheme",
      "label": "配色方案",
      "default": "background-1",
      "options": [
        { "value": "background-1", "label": "背景 1" },
        { "value": "background-2", "label": "背景 2" },
        { "value": "inverse", "label": "反色" }
      ]
    }
  ],
  "presets": [{ "name": "Product Accessories" }]
}
{% endschema %}
